// Updated 8.26.15
!function(){function t(){this.buttons=[],this.init()}var e={disable:{count:!1,cookies:!0},button:{container:{"class":"ig-follow"},image:{"class":"ig-camera"},background:{"class":"IGF"},text:{"class":"ig-text"},states:{"default":{text:"Follow"},done:{text:"Following","class":"followed"}}},errorHTML:{count:'<div class="ig-count" id="c"><i></i><u></u><a class="ig-err" target="_blank" href="http://instagramfollowbutton.com/components/instagram/v2/reverify.php">err</a></div>'},instagram_api:{PERMANENT_REDIRECT_URL:"http://instafollowbutton.com/components/instagram/instagram-redirect-handler.php",PERMANENT_CLIENT_ID:"815fae9633594752a20bde394773be2c"},template:{button:{url:"//x.instagramfollowbutton.com/components/instagram/v2/followButton.php"},css:{url:"//x.instagramfollowbutton.com/css/igFollow.css"}},images:{"default":{url:"//x.instagramfollowbutton.com/components/instagram/v2/img/ig-camera.png"},loading:{url:"//x.instagramfollowbutton.com/components/instagram/v2/img/loading.gif"},error:{url:"//x.instagramfollowbutton.com/components/instagram/v2/img/ig-camera.png"}}},n=function(n){var a={user:{id:!1,name:!1},createCookie:function(t,e,n){var i;if(n){var a=new Date;a.setTime(a.getTime()+1e3*n),i="; expires="+a.toGMTString()}else i="";document.cookie=t+"="+e+i+"; path=/"},readCookie:function(t){for(var e=t+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var a=n[i];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(e))return a.substring(e.length,a.length)}return null},eraseCookie:function(t){this.createCookie(t,"",-1)},data:{},init:function(t){this.element=t,this.setData(),this.data.state="ready"},setData:function(){var t={id:this.element.getAttribute("data-id"),ignore:this.element.getAttribute("data-ignore")?this.element.getAttribute("data-ignore"):!1,followed:this.element.getAttribute("data-followed")?this.element.getAttribute("data-followed"):!1,size:this.element.getAttribute("data-size")?this.element.getAttribute("data-size"):"small",username:this.element.getAttribute("data-username")?this.element.getAttribute("data-username"):"false",showCount:this.element.getAttribute("data-count")&&1!=e.disable.count?this.element.getAttribute("data-count"):"false"};this.data=t},createCDNCacheBuster:function(){var t=new Date,e=t.getUTCDate(),n=t.getUTCMonth(),i=t.getUTCFullYear(),a=t.getUTCMinutes(),s=t.getUTCHours(),o=15*parseInt((a+7.5)/15)%60,r=a>52?23===s?0:++s:s;return i+"-"+n+"-"+e+"-"+r+"-"+o},params:function(){var t=this;return{id:this.element.getAttribute("data-id"),size:this.element.getAttribute("data-size")?this.element.getAttribute("data-size"):"small",username:this.element.getAttribute("data-username")?this.element.getAttribute("data-username"):"false",showCount:this.element.getAttribute("data-count")&&1!=e.disable.count?this.element.getAttribute("data-count"):"false",cacheBuster:t.createCDNCacheBuster()}},click:function(){var e=this.data.followed;if(!e&&"loading"!=this.data.state&&"error"!=this.data.state){this.loading();var n=this.user.id+"|"+this.user.name+"|"+this.data.id+"|"+this.referrer,i="https://instagram.com/oauth/authorize/?client_id="+this.clientID+"&redirect_uri="+this.redirectURI+"&state="+n+"&response_type=code&scope=relationships";t.popup=window.open(i,"mywindow","menubar=1,resizable=1,width=500,height=400"),this.beginChildWindowPoll()}},beginChildWindowPoll:function(){t.interval&&clearInterval(t.interval),t.interval=setInterval(function(){0==this.checkIfChildWindowIsOpen()&&(this.done(),this.endChildWindowPoll())}.bind(this),2e3)},endChildWindowPoll:function(){clearInterval(t.interval)},checkIfChildWindowIsOpen:function(){return t.popup.closed?!1:!0},bindEvents:function(){var t=this;this.element.onclick=function(){t.click()}},findClass:function(t,e){function n(t,e,a){for(var s=0;s<t.childNodes.length&&!a;s++){for(var o=t.childNodes[s],r=void 0!=o.className?o.className.split(" "):[],l=0,u=r.length;u>l;l++)if(r[l]==e){a=!0,i=t.childNodes[s];break}if(a)break;n(t.childNodes[s],e,a)}}var i=null;return n(t,e,!1),i},process:function(){function t(){var t,i="true"==n.data.username?"Follow @"+n.user.name:"Follow";t=-1==n.user.count?e.errorHTML.count:"true"==n.data.showCount?'<div class="ig-count" id="c"><i></i><u></u><a>'+n.user.count+"</a></div>":"",n.element.innerHTML='<div title="Follow @'+n.user.name+' on Instagram" class="IGF '+n.data.size+'"><div class="ig-background"><img class="ig-camera" src="'+e.images["default"].url+'" height="16" width="16"/><span class="ig-text">'+i+"</span></div>"+t+"</div>",n.image=n.findClass(n.element,e.button.image["class"]),n.text=n.findClass(n.element,e.button.text["class"]),n.button=n.findClass(n.element,e.button.background["class"])}var n=this,a=n.readCookie("IGFB"),s=!1;if(s)return console&&console.warn&&console.warn("Script temporarily blocked."),!1;if(a&&!e.disable.cookies){var o=JSON.parse(a);n.user.name=o.user.name,n.user.id=o.user.id,n.user.count=o.user.count,t()}else i.fetch(e.template.button.url,n.params(),function(e){n.user.name=e.user.name,n.user.id=e.user.id,n.user.count=e.user.count;var i={user:{name:n.user.name,id:n.user.id,count:n.user.count}},a=3600;n.createCookie("IGFB",JSON.stringify(i),a),t()});n.referrer=document.URL,n.redirectURI=e.instagram_api.PERMANENT_REDIRECT_URL,n.clientID=e.instagram_api.PERMANENT_CLIENT_ID,n.bindEvents()},followed:function(){this.text.innerHTML="true"==this.data.username?e.button.states.done.text+" @"+this.user.name:e.button.states.done.text,this.button.className+=" "+e.button.states.done["class"],this.data.followed=!0,this.done()},loading:function(){this.data.state="loading",this.image.setAttribute("src",e.images.loading.url)},done:function(){this.data.state="done",this.image.setAttribute("src",e.images["default"].url)},error:function(){this.data.state="error",this.text.innerHTML="Error",this.image.setAttribute("src",e.images.error.url)},failed:function(){this.done(),t.popup.close()}};return a.init(n),a};t.prototype={init:function(){for(var t=document.querySelectorAll("."+e.button.container["class"]),i=0;i<t.length;i++){var a=t[i].getAttribute("data-ignore")||!t[i].getAttribute("data-id")||"false";"false"==a&&this.buttons.push(new n(t[i]))}this.getStylesheet(),this.populateButtons(),this.bindPostMessage()},clickButton:function(t){for(var e=0;e<allFollowButtons.length;e++)allFollowButtons[e].user.id==t&&allFollowButtons[e].click()},receiveMessage:function(t){var e;if(t.data){try{e=JSON.parse(t.data)}catch(n){e=!1}if(e&&e.action&&"followed"==e.action&&e.hash)this.processFollowed(e.hash),window.setTimeout(function(){this.popup.close()}.bind(this),1e3);else if(e&&"cancelled"==e.action){window.setTimeout(function(){this.popup.close()}.bind(this),1e3);for(var i=0;i<this.buttons.length;i++)this.buttons[i].done()}else if(e&&e.action)for(var i=0;i<this.buttons.length;i++)this.buttons[i].done()}},bindPostMessage:function(){window.addEventListener?window.addEventListener("message",function(e){e.data&&t.receiveMessage(e)}):window.attachEvent&&window.attachEvent("onmessage",function(e){e.data&&t.receiveMessage(e)})},processFollowed:function(t){for(var e=0;e<this.buttons.length;e++)this.buttons[e].data.id==t&&this.buttons[e].followed()},getStylesheet:function(){var t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href=e.template.css.url,document.getElementsByTagName("head")[0].appendChild(t)},populateButtons:function(){for(var t=0;t<this.buttons.length;t++)this.buttons[t].process()}};var i={callbackCounter:0,fetch:function(t,e,n){var i="jsonp_callback"+this.callbackCounter++,a=[],s="";window[i]=this.evalJSONP(n),t+="?jsonp_callback="+i;for(s in e)a.push(s+"="+encodeURIComponent(e[s]));t+=t.indexOf("?")+1?"&":"?",t+=a.join("&");var o=document.createElement("SCRIPT");o.src=t,document.getElementsByTagName("HEAD")[0].appendChild(o)},evalJSONP:function(t){return function(e){var n=!1;if("string"==typeof e)try{n=JSON.parse(e)}catch(i){}else n=JSON.parse(JSON.stringify(e));if(!n)throw"JSONP call returned invalid or empty JSON";t(n)}}},t=new t}();